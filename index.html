<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SQS Test System</title>
  <style>
    :root {
      --bg: #f7f9fb;
      --card: #ffffff;
      --text: #1f2937;
      --muted: #4b5563;
      --primary: #2563eb;
      --border: #e5e7eb;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .shell {
      max-width: 960px;
      margin: 32px auto 48px auto;
      padding: 0 20px;
    }

    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 28px;
      border: 1px solid var(--border);
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.05);
    }

    h1 {
      margin: 0 0 10px 0;
      font-size: 28px;
      letter-spacing: -0.3px;
    }

    p.lead {
      margin: 0 0 18px 0;
      color: var(--muted);
    }

    .page-section {
      display: none;
    }

    .language-row {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 8px;
      margin-bottom: 12px;
    }

    .language-row label {
      font-weight: 600;
    }

    select {
      padding: 8px 10px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: #fff;
      font-size: 14px;
      color: var(--text);
    }

    .section-header {
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }

    .actions {
      margin-top: 18px;
      display: flex;
      justify-content: center;
      gap: 12px;
    }

    button {
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 12px 18px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.2s ease;
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.2);
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(37, 99, 235, 0.25);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2);
    }

    .question_block {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 16px;
      background: #fdfefe;
    }

    .question_title {
      font-weight: 600;
      margin-bottom: 10px;
    }

    .options {
      display: grid;
      gap: 10px;
    }

    .optionButton {
      background: #ffffff;
      color: var(--text);
      border: 1px solid var(--border);
      padding: 10px;
      text-align: left;
      border-radius: 8px;
      box-shadow: none;
    }

    .optionButton.selected {
      border-color: var(--primary);
      background: #eef2ff;
    }

    .likert-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .likert-label {
      flex: 1 1 240px;
    }

    .likert-options {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .likert-button {
      background: #fff;
      color: var(--text);
      border: 1px solid var(--border);
      padding: 8px 10px;
      border-radius: 6px;
      min-width: 40px;
      text-align: center;
    }

    .likert-button.selected {
      background: #eef2ff;
      border-color: var(--primary);
      color: var(--primary);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }

    th, td {
      padding: 10px;
      border: 1px solid var(--border);
      text-align: center;
    }

    th {
      background: #f3f4f6;
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="card">
      <header class="section-header">
        <div class="language-row">
          <label for="language_selector" id="language_label"></label>
          <select id="language_selector"></select>
        </div>
        <h1 id="title_main">SQS — Structural Intelligence Quotient Test</h1>
        <p class="lead" id="lead_text">Single-page flow for introduction, self-assessment, module tasks, and results.</p>
      </header>

      <div id="page_intro" class="page-section">
        <h2 id="intro_heading">Introduction</h2>
        <div id="intro_content" class="question_block"></div>
        <div class="actions">
          <button type="button" id="btn_intro_continue">Continue</button>
        </div>
      </div>

      <div id="page_self_assessment" class="page-section">
        <h2 id="self_heading">Self-Assessment</h2>
        <div id="self_assessment_container"></div>
        <div class="actions">
          <button type="button" id="btn_self_assessment_continue">Continue to Modules</button>
        </div>
      </div>

      <div id="page_test_fl" class="page-section">
        <h2 data-domain="fl">Module: FL</h2>
        <div class="module_container" data-module="fl"></div>
        <div class="actions">
          <button type="button" id="btn_fl_finish">Finish Module</button>
        </div>
      </div>

      <div id="page_test_rr" class="page-section">
        <h2 data-domain="rr">Module: RR</h2>
        <div class="module_container" data-module="rr"></div>
        <div class="actions">
          <button type="button" id="btn_rr_finish">Finish Module</button>
        </div>
      </div>

      <div id="page_test_mf" class="page-section">
        <h2 data-domain="mf">Module: MF</h2>
        <div class="module_container" data-module="mf"></div>
        <div class="actions">
          <button type="button" id="btn_mf_finish">Finish Module</button>
        </div>
      </div>

      <div id="page_test_sc" class="page-section">
        <h2 data-domain="sc">Module: SC</h2>
        <div class="module_container" data-module="sc"></div>
        <div class="actions">
          <button type="button" id="btn_sc_finish">Finish Module</button>
        </div>
      </div>

      <div id="page_test_ph" class="page-section">
        <h2 data-domain="ph">Module: PH</h2>
        <div class="module_container" data-module="ph"></div>
        <div class="actions">
          <button type="button" id="btn_ph_finish">Finish Module</button>
        </div>
      </div>

      <div id="page_test_ssc" class="page-section">
        <h2 data-domain="ssc">Module: SSC</h2>
        <div class="module_container" data-module="ssc"></div>
        <div class="actions">
          <button type="button" id="btn_ssc_finish">Finish Module</button>
        </div>
      </div>

      <div id="page_results" class="page-section">
        <h2 id="results_heading">Results</h2>
        <div id="results_container"></div>
      </div>
    </div>
  </div>

  <script>
    const LANG = {
      en: {
        languageName: 'English',
        pageTitle: 'SQS Test System',
        languageLabel: 'Language',
        title: 'SQS — Structural Intelligence Quotient Test',
        lead: 'Single-page flow for introduction, self-assessment, module tasks, and results.',
        introHeading: 'Introduction',
        introContinue: 'Continue',
        selfHeading: 'Self-Assessment',
        selfContinue: 'Continue to Modules',
        resultsHeading: 'Results',
        finishModule: 'Finish Module',
        moduleTitle: 'Module: {module}',
        loadingIntro: 'Loading introduction...',
        introLoadError: 'Unable to load introduction.',
        loadingTasks: 'Loading tasks...',
        tasksLoadError: 'Unable to load tasks.',
        missingOptions: 'Task data missing options.',
        tableHeaders: ['Domain', 'Self-assessment (1-7)', 'Ability score (0-100)'],
        notProvided: 'Not provided',
        domainLabels: { fl: 'FL', rr: 'RR', mf: 'MF', sc: 'SC', ph: 'PH', ssc: 'SSC' },
        selfAssessmentSuffix: 'Self-Assessment',
        selfStatements: {
          fl: [
            'I quickly see how parts of a system connect together.',
            'I can map complex ideas into simple diagrams.',
            'I enjoy comparing different structures to find patterns.',
            'I notice when a structure violates its own rules.',
            'I can reconstruct a model after seeing it only briefly.',
          ],
          rr: [
            'I identify the critical path in a process with ease.',
            'I evaluate the reliability of information sources quickly.',
            'I catch inconsistencies in arguments without much effort.',
            'I can trace errors back to their root causes.',
            'I anticipate where systems are most likely to fail.',
          ],
          mf: [
            'I keep track of multiple constraints while planning.',
            'I juggle several solution approaches at the same time.',
            'I maintain focus even when details become dense.',
            'I connect abstract concepts to practical examples.',
            'I reorganize information to make it easier to recall.',
          ],
          sc: [
            'I quickly spot sequences and progressions in data.',
            'I understand how changing one piece affects the timeline.',
            'I like arranging tasks in the most efficient order.',
            'I visualize chain reactions before they occur.',
            'I can optimize steps to save time or resources.',
          ],
          ph: [
            'I learn best by experimenting with tangible examples.',
            'I mentally simulate physical movements accurately.',
            'I can break down physical tasks into precise steps.',
            'I visualize spatial layouts from different angles.',
            'I handle hands-on problem-solving confidently.',
          ],
          ssc: [
            'I empathize with team dynamics while solving problems.',
            'I communicate complex ideas in relatable ways.',
            'I notice interpersonal signals that affect outcomes.',
            "I adapt my approach to match the group's energy.",
            'I encourage collaboration when tackling challenges.',
          ],
        },
      },
      es: {
        languageName: 'Español',
        pageTitle: 'Sistema de Prueba SQS',
        languageLabel: 'Idioma',
        title: 'SQS — Prueba de Cociente de Inteligencia Estructural',
        lead: 'Flujo de una sola página para introducción, autoevaluación, módulos y resultados.',
        introHeading: 'Introducción',
        introContinue: 'Continuar',
        selfHeading: 'Autoevaluación',
        selfContinue: 'Continuar a los módulos',
        resultsHeading: 'Resultados',
        finishModule: 'Finalizar módulo',
        moduleTitle: 'Módulo: {module}',
        loadingIntro: 'Cargando introducción...',
        introLoadError: 'No se pudo cargar la introducción.',
        loadingTasks: 'Cargando tareas...',
        tasksLoadError: 'No se pudieron cargar las tareas.',
        missingOptions: 'Faltan opciones en la tarea.',
        tableHeaders: ['Dominio', 'Autoevaluación (1-7)', 'Puntaje de habilidad (0-100)'],
        notProvided: 'No proporcionado',
        domainLabels: { fl: 'FL', rr: 'RR', mf: 'MF', sc: 'SC', ph: 'PH', ssc: 'SSC' },
        selfAssessmentSuffix: 'Autoevaluación',
        selfStatements: {
          fl: [
            'Veo rápidamente cómo se conectan las partes de un sistema.',
            'Puedo plasmar ideas complejas en diagramas simples.',
            'Disfruto comparando estructuras para encontrar patrones.',
            'Noto cuando una estructura viola sus propias reglas.',
            'Puedo reconstruir un modelo después de verlo brevemente.',
          ],
          rr: [
            'Identifico con facilidad el camino crítico de un proceso.',
            'Evalúo rápidamente la fiabilidad de las fuentes de información.',
            'Detecto inconsistencias en argumentos sin mucho esfuerzo.',
            'Puedo rastrear errores hasta sus causas raíz.',
            'Anticipo dónde es más probable que fallen los sistemas.',
          ],
          mf: [
            'Mantengo múltiples restricciones en mente al planificar.',
            'Manejo varias soluciones a la vez.',
            'Mantengo la concentración incluso cuando los detalles son densos.',
            'Conecto conceptos abstractos con ejemplos prácticos.',
            'Reorganizo la información para recordarla con facilidad.',
          ],
          sc: [
            'Detecto rápidamente secuencias y progresiones en los datos.',
            'Entiendo cómo cambiar una pieza afecta la cronología.',
            'Me gusta ordenar tareas en el orden más eficiente.',
            'Visualizo reacciones en cadena antes de que ocurran.',
            'Puedo optimizar pasos para ahorrar tiempo o recursos.',
          ],
          ph: [
            'Aprendo mejor experimentando con ejemplos tangibles.',
            'Simulo mentalmente movimientos físicos con precisión.',
            'Puedo descomponer tareas físicas en pasos precisos.',
            'Visualizo distribuciones espaciales desde distintos ángulos.',
            'Resuelvo problemas prácticos con confianza.',
          ],
          ssc: [
            'Empatizo con la dinámica del equipo al resolver problemas.',
            'Comunico ideas complejas de forma cercana.',
            'Noto señales interpersonales que afectan resultados.',
            'Adapto mi enfoque a la energía del grupo.',
            'Fomento la colaboración al enfrentar retos.',
          ],
        },
      },
    };

    let currentLanguage = 'en';
    let currentPage = "page_intro";

    const sqsResults = {
      fl: [],
      rr: [],
      mf: [],
      sc: [],
      ph: [],
      ssc: [],
    };

    let selectedTasks = {
      fl: [],
      rr: [],
      mf: [],
      sc: [],
      ph: [],
      ssc: [],
    };

    let selfScores = { fl: [], rr: [], mf: [], sc: [], ph: [], ssc: [] };

    function t(key, replacements = {}) {
      const langPack = LANG[currentLanguage] || LANG.en;
      const value = langPack[key] ?? LANG.en[key] ?? '';
      if (typeof value !== 'string') return value;
      return Object.entries(replacements).reduce((acc, [k, v]) => acc.replace(`{${k}}`, v), value);
    }

    function getDomainLabel(domain) {
      const langPack = LANG[currentLanguage] || LANG.en;
      return langPack.domainLabels?.[domain] || domain.toUpperCase();
    }

    function showPage(id) {
      document.querySelectorAll('.page-section').forEach((el) => {
        el.style.display = 'none';
      });
      const target = document.getElementById(id);
      if (target) {
        target.style.display = 'block';
        currentPage = id;
      }
    }

    async function loadModuleTasks(url) {
      const response = await fetch(url);
      if (!response.ok) throw new Error('Failed to load tasks');
      const data = await response.json();
      return Array.isArray(data) ? data : [];
    }

    function shuffle(array) {
      const copy = [...array];
      for (let i = copy.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    function takeRandom(source, count) {
      const pool = [...source];
      const result = [];
      while (pool.length && result.length < count) {
        const idx = Math.floor(Math.random() * pool.length);
        result.push(pool.splice(idx, 1)[0]);
      }
      return result;
    }

    function selectTenTasks(allTasks) {
      const selected = [];
      const remaining = [...allTasks];

      for (let level = 1; level <= 4; level += 1) {
        const matches = remaining.filter((task) => task.difficulty === level);
        const picks = takeRandom(matches, 2);
        selected.push(...picks);
        picks.forEach((pick) => {
          const idx = remaining.findIndex((t) => t.id === pick.id);
          if (idx >= 0) remaining.splice(idx, 1);
        });
      }

      const extras = takeRandom(remaining, 2);
      selected.push(...extras);

      return shuffle(selected).slice(0, 10);
    }

    class ModuleRunner {
      constructor(moduleId, jsonUrl, nextPageId) {
        this.moduleId = moduleId;
        this.jsonUrl = jsonUrl;
        this.nextPageId = nextPageId;
        this.tasks = [];
        this.answers = [];
        this.container = document.querySelector(`#page_test_${moduleId} .module_container`);
      }

      async start() {
        if (!this.container) return;
        this.container.innerHTML = `<div class="question_block">${t('loadingTasks')}</div>`;
        try {
          const allTasks = await loadModuleTasks(this.jsonUrl);
          this.tasks = selectTenTasks(allTasks);
          selectedTasks[this.moduleId] = this.tasks;
          this.answers = new Array(this.tasks.length).fill(null);
          this.renderAllTasks();
        } catch (err) {
          this.container.innerHTML = `<div class="question_block">${t('tasksLoadError')}</div>`;
        }
      }

      renderAllTasks() {
        if (!this.container || !this.tasks.length) return;
        this.container.innerHTML = '';

        this.tasks.forEach((task, idx) => {
          const block = document.createElement('div');
          block.className = 'question_block';

          const title = document.createElement('div');
          title.className = 'question_title';
          title.textContent = `${idx + 1}. ${task.question}`;
          block.appendChild(title);

          const optionsWrapper = document.createElement('div');
          optionsWrapper.className = 'options';

          if (task.options && task.options.length >= 4) {
            task.options.slice(0, 4).forEach((opt, optIdx) => {
              const btn = document.createElement('button');
              btn.type = 'button';
              btn.className = 'optionButton';
              btn.textContent = `${String.fromCharCode(65 + optIdx)}. ${opt}`;
              if (this.answers[idx] === optIdx) {
                btn.classList.add('selected');
              }
              btn.addEventListener('click', () => {
                this.recordAnswer(idx, optIdx);
                optionsWrapper.querySelectorAll('button').forEach((b) => b.classList.remove('selected'));
                btn.classList.add('selected');
              });
              optionsWrapper.appendChild(btn);
            });
          } else {
            optionsWrapper.textContent = t('missingOptions');
          }

          block.appendChild(optionsWrapper);
          this.container.appendChild(block);
        });
      }

      recordAnswer(taskIndex, choiceIndex) {
        this.answers[taskIndex] = choiceIndex;
      }

      finishModule() {
        sqsResults[this.moduleId] = this.answers;
        showPage(this.nextPageId);
        if (modules[this.nextPageId.replace('page_test_', '')]) {
          modules[this.nextPageId.replace('page_test_', '')].start();
        }
        if (this.nextPageId === 'page_results') {
          renderResults();
        }
      }
    }

    const modules = {
      fl: new ModuleRunner('fl', 'tasks_fl.json', 'page_test_rr'),
      rr: new ModuleRunner('rr', 'tasks_rr.json', 'page_test_mf'),
      mf: new ModuleRunner('mf', 'tasks_mf.json', 'page_test_sc'),
      sc: new ModuleRunner('sc', 'tasks_sc.json', 'page_test_ph'),
      ph: new ModuleRunner('ph', 'tasks_ph.json', 'page_test_ssc'),
      ssc: new ModuleRunner('ssc', 'tasks_ssc.json', 'page_results'),
    };

    function loadIntro() {
      const container = document.getElementById('intro_content');
      if (!container) return;
      container.textContent = t('loadingIntro');
      fetch('sqs.md')
        .then((r) => r.text())
        .then((text) => {
          container.textContent = text;
        })
        .catch(() => {
          container.textContent = t('introLoadError');
        });
    }

    function renderSelfAssessment() {
      const container = document.getElementById('self_assessment_container');
      if (!container) return;
      container.innerHTML = '';

      const statementsByDomain = LANG[currentLanguage]?.selfStatements || LANG.en.selfStatements;

      Object.entries(statementsByDomain).forEach(([domain, statements]) => {
        if (!Array.isArray(selfScores[domain]) || !selfScores[domain].length) {
          selfScores[domain] = new Array(statements.length).fill(null);
        } else if (selfScores[domain].length < statements.length) {
          selfScores[domain].length = statements.length;
          selfScores[domain] = selfScores[domain].map((v) => (typeof v === 'undefined' ? null : v));
        }

        const section = document.createElement('div');
        section.className = 'question_block';

        const title = document.createElement('div');
        title.className = 'question_title';
        title.textContent = `${getDomainLabel(domain)} ${t('selfAssessmentSuffix')}`;
        section.appendChild(title);

        statements.forEach((statement, idx) => {
          const row = document.createElement('div');
          row.className = 'likert-row';

          const label = document.createElement('div');
          label.className = 'likert-label';
          label.textContent = `${idx + 1}. ${statement}`;
          row.appendChild(label);

          const options = document.createElement('div');
          options.className = 'likert-options';

          for (let score = 1; score <= 7; score += 1) {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'likert-button';
            btn.textContent = score;
            btn.addEventListener('click', () => {
              selfScores[domain][idx] = score;
              options.querySelectorAll('button').forEach((b) => b.classList.remove('selected'));
              btn.classList.add('selected');
            });
            if (selfScores[domain][idx] === score) {
              btn.classList.add('selected');
            }

            options.appendChild(btn);
          }

          row.appendChild(options);
          section.appendChild(row);
        });

        container.appendChild(section);
      });
    }

    function attachModuleFinishHandlers() {
      document.getElementById('btn_fl_finish')?.addEventListener('click', () => modules.fl.finishModule());
      document.getElementById('btn_rr_finish')?.addEventListener('click', () => modules.rr.finishModule());
      document.getElementById('btn_mf_finish')?.addEventListener('click', () => modules.mf.finishModule());
      document.getElementById('btn_sc_finish')?.addEventListener('click', () => modules.sc.finishModule());
      document.getElementById('btn_ph_finish')?.addEventListener('click', () => modules.ph.finishModule());
      document.getElementById('btn_ssc_finish')?.addEventListener('click', () => modules.ssc.finishModule());
    }

    function computeSelfAverages() {
      const averages = {};
      Object.entries(selfScores).forEach(([domain, scores]) => {
        const validScores = (scores || []).filter((val) => val !== null && typeof val !== 'undefined');
        if (!validScores.length) {
          averages[domain] = t('notProvided');
        } else {
          const sum = validScores.reduce((acc, val) => acc + Number(val), 0);
          averages[domain] = (sum / validScores.length).toFixed(2);
        }
      });
      return averages;
    }

    function computeAbilityScores() {
      const abilities = {};
      Object.entries(sqsResults).forEach(([domain, answers]) => {
        const tasks = selectedTasks[domain] || [];
        let correctCount = 0;
        answers.forEach((answerIdx, i) => {
          const task = tasks[i];
          if (task && Number(task.correctIndex) === Number(answerIdx)) correctCount += 1;
        });
        abilities[domain] = tasks.length ? ((correctCount / 10) * 100).toFixed(0) : '0';
      });
      return abilities;
    }

    function renderResults() {
      const container = document.getElementById('results_container');
      if (!container) return;
      const selfAvg = computeSelfAverages();
      const abilityScores = computeAbilityScores();

      const table = document.createElement('table');
      const thead = document.createElement('thead');
      const headRow = document.createElement('tr');
      (t('tableHeaders') || []).forEach((label) => {
        const th = document.createElement('th');
        th.textContent = label;
        headRow.appendChild(th);
      });
      thead.appendChild(headRow);
      table.appendChild(thead);

      const tbody = document.createElement('tbody');
      ['fl', 'rr', 'mf', 'sc', 'ph', 'ssc'].forEach((domain) => {
        const row = document.createElement('tr');
        const domainCell = document.createElement('td');
        domainCell.textContent = getDomainLabel(domain);
        const selfCell = document.createElement('td');
        selfCell.textContent = selfAvg[domain] ?? t('notProvided');
        const abilityCell = document.createElement('td');
        abilityCell.textContent = abilityScores[domain] ?? '0';
        row.appendChild(domainCell);
        row.appendChild(selfCell);
        row.appendChild(abilityCell);
        tbody.appendChild(row);
      });
      table.appendChild(tbody);

      container.innerHTML = '';
      container.appendChild(table);
    }

    function applyLanguage() {
      const langPack = LANG[currentLanguage] || LANG.en;
      document.documentElement.lang = currentLanguage;
      document.title = langPack.pageTitle;

      document.getElementById('language_label').textContent = langPack.languageLabel;
      document.getElementById('title_main').textContent = langPack.title;
      document.getElementById('lead_text').textContent = langPack.lead;
      document.getElementById('intro_heading').textContent = langPack.introHeading;
      document.getElementById('self_heading').textContent = langPack.selfHeading;
      document.getElementById('results_heading').textContent = langPack.resultsHeading;

      document.getElementById('btn_intro_continue').textContent = langPack.introContinue;
      document.getElementById('btn_self_assessment_continue').textContent = langPack.selfContinue;

      document.querySelectorAll('#page_intro button, #page_self_assessment button').forEach((btn) => {
        btn.setAttribute('aria-label', btn.textContent);
      });

      document.querySelectorAll('[id^="page_test_"] h2[data-domain]').forEach((heading) => {
        const domain = heading.getAttribute('data-domain');
        heading.textContent = t('moduleTitle', { module: getDomainLabel(domain) });
      });

      document
        .querySelectorAll('#page_test_fl button, #page_test_rr button, #page_test_mf button, #page_test_sc button, #page_test_ph button, #page_test_ssc button')
        .forEach((btn) => {
          btn.textContent = langPack.finishModule;
        });

      renderSelfAssessment();
    }

    function setupLanguageSelector() {
      const selector = document.getElementById('language_selector');
      if (!selector) return;
      selector.innerHTML = '';
      Object.entries(LANG).forEach(([key, value]) => {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = value.languageName;
        if (key === currentLanguage) option.selected = true;
        selector.appendChild(option);
      });

      selector.addEventListener('change', (event) => {
        currentLanguage = event.target.value;
        applyLanguage();
      });
    }

    function setupFlow() {
      setupLanguageSelector();
      applyLanguage();
      showPage(currentPage);
      loadIntro();
      attachModuleFinishHandlers();

      document.getElementById('btn_intro_continue')?.addEventListener('click', () => {
        showPage('page_self_assessment');
      });

      document.getElementById('btn_self_assessment_continue')?.addEventListener('click', () => {
        modules.fl.start();
        showPage('page_test_fl');
      });
    }

    window.addEventListener('DOMContentLoaded', setupFlow);
  </script>
</body>
</html>
